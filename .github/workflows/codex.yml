name: OpenAI Codex Debug
on:
  issue_comment:
    types: [created]

jobs:
  codex-debug:
    if: contains(github.event.comment.body, '@codex-debug')
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '20'
      - name: Install OpenAI Codex CLI
        run: npm install -g @openai/codex
      - name: Debug Codex
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        run: |
          echo "=== Codex version ==="
          codex --version || echo "Version failed"
          
          echo "=== Codex help ==="
          codex --help || echo "Help failed"
          
          echo "=== Network test ==="
          curl -I https://api.openai.com || echo "OpenAI API unreachable"
          
          echo "=== Environment ==="
          echo "OPENAI_API_KEY length: ${#OPENAI_API_KEY}"
          echo "HOME: $HOME"
          ls -la $HOME || echo "Home listing failed"
          
          echo "=== Simple test ==="
          echo "hello world" | codex || echo "Simple test failed"
